<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-Frame Movement</title>
    <!-- A-Frame Framework and Component Scripts -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.misc.min.js"></script><!-- sphere-collider-->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.controls.min.js"></script><!-- movement-controls -->
    <script src="components/simple-navmesh-constraint.js"></script><!-- From Ada Rose Cannon -->
    <script src="https://unpkg.com/super-hands@^3.0.3/dist/super-hands.min.js"></script>
    <!-- For some unknown reason, targeting the component remotely does not work. It's weird as a downloaded and locally referenced version does work. -->
    <!-- <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.js"></script> -->
    <script src="components/aframe-teleport-controls.js"></script>

    <!-- James' Components -->
    <script src="components/mesh-shadows.js"></script>
    <script src="components/a-water.js"></script>
    <script src="components/code.js"></script>

</head>
<body>
    <a-scene scenemgr renderer="colorManagement:false;" >
        <div style="position:absolute; z-index: 100;">
            <div id="text" style="color:white; font-size: 1.25em; text-align:center;">Now it's ...Grab 1.0.3</div>
        </div>
        <a-asset>
            <a-asset-item id="level" src="assets/meshes/Level.glb" ></a-asset-item>
            <a-asset-item id="navMesh" src="assets/meshes/Navmesh.glb" ></a-asset-item>
            <a-asset-item id="sub" src="assets/meshes/submarine.glb" ></a-asset-item>
            <a-mixin id="coin" geometry="primitive:cylinder; height:0.1; radius:0.25;" material="color:#ffaa00;" ></a-mixin>
            <a-mixin 
                id="fuel" 
                geometry="primitive:octahedron; radius:1;" 
                scale="0.25 0.5 0.25" 
                material="color:#ff2266; emissive:#05a; transparent:true; opacity:0.85; side:double;" ></a-mixin>
            <a-mixin id="spinCoin" animation__rot="property:rotation; to:0 0 360; loop:true; dur:2000; easing:linear; autoplay: false;"></a-mixin>
            <a-mixin id="spinFuelGem" animation__rot="property:rotation; to:0 360 0; loop:true; dur:2000; easing:linear; autoplay: false;"></a-mixin>
            <a-mixin id="bobCoin" animation__pos="property:position; to:0 0 0.25; dir:alternate; loop:true; dur:1000; easing:easeInOutQuad; autoplay: false;"></a-mixin>
            <a-mixin id="bobFuelGem" animation__pos="property:position; to:0 1.25 0; dir:alternate; loop:true; dur:1000; easing:easeInOutQuad; autoplay: false;"></a-mixin>
        </a-asset>

        <!-- scene objects - Collectable Coins -->
        <a-entity position="3 3 -4" rotation="90 0 0">
            <a-entity id="coin_01" mixin="coin spinCoin bobCoin" class="grabbable clickable" grabbable animstart ></a-entity>
        </a-entity>
        <a-entity position="4 1 -4" rotation="90 0 0">
            <a-entity id="coin_02" mixin="coin spinCoin bobCoin" class="grabbable clickable" grabbable animstart></a-entity>
        </a-entity>
        <a-entity position="-3 3 -2" rotation="90 0 0">
            <a-entity id="coin_03" mixin="coin spinCoin bobCoin" class="grabbable clickable" grabbable animstart></a-entity>
        </a-entity>
        <a-entity position="-4 3 4.5" rotation="90 0 0">
            <a-entity id="coin_04" mixin="coin spinCoin bobCoin" class="grabbable clickable" grabbable animstart></a-entity>
        </a-entity>
        
        <!-- Fuel Gem - Goal of 'Game' -->
        <a-entity id="fuelGem" position="-2.25 0 2.75" visible="false">
            <a-entity id="fuel_gem" class="not-clickable" mixin="fuel spinFuelGem bobFuelGem" position="0 1 0" rotation="0 0 0"></a-entity>
            <a-light type="point" position="0 1 0" intensity="1.0" distance="4"></a-light>
        </a-entity>

        <!-- Submarine - Goal: Get Fuel Gem to Power Sub for Getaway -->
        <a-gltf-model id="gameLvl" src="#level" mesh-shadows visible="true" ></a-gltf-model>
        <a-gltf-model class="nav-mesh" gltf-model="#navMesh" position="0 0 0" visible="false"></a-gltf-model>
        <a-entity 
           id="subRig" 
           position="0 0 0"
           animation="property:position; to: 20 -3 0; dur:10000; easing:easeInQuad; autoplay:false;">
           <a-gltf-model 
              id="submarine" 
              class="not-clickable" 
              visible="true"
              position="3 -1 6.5"
              rotation="-1.5 90 -1.5" 
              gltf-model="#sub"
              animation="property:position; to:3 -0.85 6.5; dir:alternate; loop:true; dur:1250; easing:easeInOutQuad;"
              animation__rotation="property:rotation; to:1.5 90 1.5; dir:alternate; loop:true; dur:1750; easing:easeInOutQuad;"
              >   
           </a-gltf-model>
        </a-entity>

        <!-- Environment -->
        <a-water
            position="0 -0.5 0"  
            width="100" 
            depth="100"
            density="75"
            wavelength="0.5" 
            amplitude="2.0" 
            speed="2"
            noise="6" 
            color="#891884"
            opacity="1.0">
        </a-water>
        <a-entity environment="preset:arches;" position="0 -4 0"></a-entity>
        
        <!-- Lights -->
        <a-light id="sunlight" position="-2.5 4.0 5" rotation="106 -25 -46.5" light="castShadow: true; shadowCameraLeft:-6.0;"></a-light>
        <a-light id="ambient" type="ambient" intensity="0.4"></a-light>        

        <!-- ********************************* -->
        <!-- ********************************* -->
        <!--        Camera Rig and Camera      -->        
        <!-- ********************************* -->
        <!-- ********************************* -->
        <!-- ******************************************** -->
        <!-- *  Camera, Feedback Text and Controllers   * -->
        <!-- ******************************************** -->
        <a-entity id="cameraRig" position="4 0 4" rotation="0 50 0" movement-controls="speed:0.1;">
            <a-entity 
                id="camera" 
                camera="near: 0.01"
                position="0 1.65 0" 
                simple-navmesh-constraint="navmesh: .nav-mesh; height:1.65; exclude: .navhole;" 
                look-controls="pointerLockEnabled:true;" >
                    <!-- Cursor -->
                    <a-cursor 
                        pointer 
                        raycaster="objects: .clickable; far: 0.5;"
                        position="0 0 -0.5"
                        color="#ffffff"
                        visible="true">
                    </a-cursor><!-- Cursor End -->
                    <!-- Text Field -->
                    <a-text id="feedback" value="Hello World" position="0 -0.1 -0.5" align="center" baseline="top" scale="0.25 0.25 0.25"></a-text><!-- Text Field End -->
                </a-entity>
            
            <!-- Left hand laser control -->
            <!-- console log to id controller type at line 73060 -->
            <a-entity id="leftHand"
                controllisten
                sphere-collider="objects: .grabbable" 
                super-hands
                grabbingtest   
                hand-controls="hand: left;"
                laser-controls="hand:left;"
                raycaster="far:0.5;">
            </a-entity> <!-- End of Left Hand -->

            <!-- Right hand teleport control -->
            <a-entity id="rightHand" 
                controllisten
                teleport-controls="cameraRig: #cameraRig; teleportOrigin: #camera; collisionEntities: .nav-mesh;"
                sphere-collider="objects: .grabbable"
                super-hands
                grabbingtest
                hand-controls="hand: right;"
                laser-controls="hand:right;"
                raycaster="far:0.5;">
            </a-entity> <!-- End of Right Hand -->

            <!-- the hand-controls does not work - appears broken:--> 
            <!-- trigger = grip, trigger+sidebutton= point+thumb up, trigger+touchpad = point + thumb down -->

            <!-- the laser-controls work as indicated above and are activated (seen) 
            when they raycaster intersects an object that is (currently) within 0.5 meters -->

    </a-scene>
</body>
</html>