<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submariner Walkabout WebXR</title>
    <!-- A-Frame Framework and Component Scripts -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.misc.min.js"></script><!-- sphere-collider-->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.controls.min.js"></script><!-- movement-controls -->
    <script src="components/simple-navmesh-constraint.js"></script><!-- From Ada Rose Cannon -->
    <script src="https://unpkg.com/super-hands@^3.0.3/dist/super-hands.min.js"></script>

    <!-- For some unknown reason, targeting the component remotely does not work. It's weird as a downloaded and locally referenced version does work. -->
    <!-- <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.js"></script> -->
    <script src="components/aframe-teleport-controls.js"></script>

    <!-- James' Components -->
    <script src="components/mesh-shadows.js"></script>
    <script src="components/a-water.js"></script>
    <script src="components/code.js"></script>

</head>
<body>
    <!-- <a-scene scenemgr renderer="colorManagement:false; antialias:false;" pixel-ratio="0.61" > creates lowrez vibe  -->
    <a-scene scenemgr renderer="colorManagement:false;" >
        <div style="position:absolute; z-index: 100;">
            <div id="text" style="color:white; font-size: 1.25em; text-align:center;">Now it's...</div>
        </div>
        <a-asset>
            <a-asset-item id="level" src="assets/meshes/Level.glb" ></a-asset-item>
            <a-asset-item id="navMesh" src="assets/meshes/Navmesh.glb" ></a-asset-item>
            <a-asset-item id="sub" src="assets/meshes/submarine.glb" ></a-asset-item>
            <a-asset-item id="coin_mesh" src="assets/meshes/Simple_Coin.glb" ></a-asset-item>
            <a-mixin id="coin" gltf-model="#coin_mesh" grabbingtest shadow="castShadow:true;" ></a-mixin>
            <a-mixin 
                id="fuel"
                grabbingtest
                geometry="primitive:octahedron; radius:1;" 
                material="color:#ff2266; emissive:#05a; transparent:true; opacity:0.85; side:double;" ></a-mixin>
            <a-mixin id="spin" animation__rot="property:rotation; to:0 360 0; loop:true; dur:2000; easing:linear; autoplay: false;"></a-mixin>
            <a-mixin id="bob" animation__pos="property:position; to:0 0.25 0; dir:alternate; loop:true; dur:1000; easing:easeInOutQuad; autoplay: false;"></a-mixin>
            <a-mixin id="collectPos" animation__collpos="property:position; to: 0 0.5 0; dur:500; easing:easeInQuad; autoplay:false;"></a-mixin>
            <a-mixin id="collectScale" animation__collscale="property:scale; to: 0.1 0.1 0.1; dur:500; easing:easeInQuad; autoplay:false;"></a-mixin>
            <a-mixin id="collectGemLightDim" animation__colllight="property:intensity; to: 0.0; dur:500; easing:easeInQuad; autoplay:false;"></a-mixin>
        </a-asset>

        <!-- scene objects - Collectable Coins -->
        <a-entity id="coin_holder_01" position="3 3 -4" mixin="collectPos collectScale">
            <a-entity id="coin_01" mixin="coin spin bob" class="grabbable clickable" grabbable hoverable animstart ></a-entity>
        </a-entity>
        <a-entity id="coin_holder_02" position="4 1 -4" mixin="collectPos collectScale">
            <a-entity id="coin_02" mixin="coin spin bob" class="grabbable clickable" grabbable hoverable animstart></a-entity>
        </a-entity>
        <a-entity id="coin_holder_03" position="-3 3 -2" mixin="collectPos collectScale">
            <a-entity id="coin_03" mixin="coin spin bob" class="grabbable clickable" grabbable hoverable animstart></a-entity>
        </a-entity>
        <a-entity id="coin_holder_04" position="-4 3 4.5" mixin="collectPos collectScale">
            <a-entity id="coin_04" mixin="coin spin bob" class="grabbable clickable" grabbable hoverable animstart></a-entity>
        </a-entity>
        
        <!-- Fuel Gem - Goal of 'Game' -->
        <a-entity id="fuelGem" mixin="collectPos collectScale" position="-2.25 0.25 2.75" visible="false" >
            <a-entity id="fuel_gem" class="not-clickable grabbable" grabbable hoverable mixin="fuel spin bob" position="0 1 0" rotation="0 0 0" scale="0.25 0.5 0.25"></a-entity>
            <a-light mixin="bob collectGemLightDim" type="point" position="0 1 0" intensity="1.0" distance="4" ></a-light>
        </a-entity>

        <a-gltf-model id="gameLvl" src="#level" mesh-shadows visible="true" ></a-gltf-model>
        <a-gltf-model class="nav-mesh" gltf-model="#navMesh" position="0 0 0" visible="false" ></a-gltf-model>
        
        <!-- Submarine - Goal: Get Fuel Gem to Power Sub for Getaway -->
        <a-entity id="subRig" 
                position="0 0 0"
                animation="property:position; to: 25 -3 0; dur:10000; easing:easeInQuad; autoplay:false;">
            <a-gltf-model 
                id="submarine" 
                class="not-clickable" 
                visible="true"
                position="3 -1 6.5"
                rotation="-1.5 90 -1.5" 
                gltf-model="#sub"
                animation="property:position; to:3 -0.85 6.5; dir:alternate; loop:true; dur:1250; easing:easeInOutQuad;"
                animation__rotation="property:rotation; to:1.5 90 1.5; dir:alternate; loop:true; dur:1750; easing:easeInOutQuad;"
                >   
            </a-gltf-model>
        </a-entity>

        <!-- Environment -->
        <a-water
            position="0 -0.5 0"  
            width="100" 
            depth="100"
            density="75"
            wavelength="0.5" 
            amplitude="2.0" 
            speed="2"
            noise="6" 
            color="#891884"
            opacity="0.95">
        </a-water>
        <a-entity environment="preset:arches;" position="0 -4 0"></a-entity>
        
        <!-- Lights -->
        <a-light id="sunlight" position="-2.5 4.0 5" rotation="106 -25 -46.5" light="castShadow: true; shadowCameraLeft:-6.0;"></a-light>
        <a-light id="ambient" type="ambient" intensity="0.4"></a-light>        

        <!-- ********************************* -->
        <!-- ********************************* -->
        <!--        Camera Rig and Camera      -->        
        <!-- ********************************* -->
        <!-- ********************************* -->
        <!-- ******************************************** -->
        <!-- *  Camera: Main, Feedback Text and Controllers   * -->
        <!-- ******************************************** -->
        <!-- <a-entity id="cameraRig" position="4 0 4" rotation="0 50 0" wasd-controls="acceleration: 10;"> -->
        <a-entity id="cameraRig" position="4 0 4" rotation="0 60 0" movement-controls="speed: 0.15;">
            <a-camera 
                id="camera"
                position="0 1.65 0"
                simple-navmesh-constraint="navmesh: .nav-mesh; height:1.65; exclude: .navhole;"
                wasd-controls="enabled: false;"  
                look-controls="pointerLockEnabled:true;" >
                    <!-- Cursor -->
                    <a-cursor 
                        pointer 
                        raycaster="objects:.clickable; far: 0.25; enabled:true;"
                        position="0 0 -0.5"
                        color="#ffffff"
                        visible="true">
                    </a-cursor><!-- Cursor End -->
                    <!-- Text Field -->
                    <a-text 
                        id="feedback" 
                        value="..." 
                        position="0 -0.1 -0.5" 
                        align="center" 
                        baseline="top" 
                        scale="0.15 0.15 0.15">
                    </a-text><!-- Text Field End -->
            </a-camera><!-- End Camera -->
            
            <!-- Left hand laser control -->
            <!-- console log to id controller type at line 73060 -->
            <a-entity id="leftHand"
                controllisten
                sphere-collider="objects:.grabbable;" 
                super-hands   
                hand-controls="hand: left;"
                laser-controls="hand:left;"
                pointer
                raycaster="objects:.clickable; far:1.0;">
            </a-entity> <!-- End Left Hand -->

            <!-- Right hand teleport control -->
            <a-entity id="rightHand" 
                controllisten
                teleport-controls="cameraRig: #cameraRig; teleportOrigin: #camera; collisionEntities: .nav-mesh;"
                sphere-collider="objects:.grabbable;"
                super-hands
                hand-controls="hand: right;"
                laser-controls="hand:right;"
                pointer
                raycaster="objects:.clickable; far:1.0;">
            </a-entity> <!-- End Right Hand -->

            <!-- the hand-controls appears broken when display different gestures. Only displays grip:--> 
            <!-- trigger = grip, trigger+sidebutton= point+thumb up, trigger+touchpad = point + thumb down -->

            <!-- the laser-controls work as indicated above and are activated (seen) 
            when they raycaster intersects an object that is (currently) within 0.5 meters -->
        </a-entity><!-- End Camera Rig -->

        <!-- Camera 2: Cinematic -->
        <!--rotation="-25 210 0"-->
        <a-entity 
            id="rig2"  
            position="0 4.45 -5"
            rotation="0 210 0"
            movement-controls="enabled:false;">
            <!-- Camera -->
            <a-entity 
               id="cinematic"
               camera="enabled:false;" 
               position="0 0 0"
               visible="false" 
               look-controls="enabled:false;">
               <a-entity>
                   <a-text value="FIN" position="0 0.1 -1" text="align:center; opacity:0.90;" ></a-text>
               </a-entity>
            </a-entity>
        </a-entity>

    </a-scene>
</body>
</html>